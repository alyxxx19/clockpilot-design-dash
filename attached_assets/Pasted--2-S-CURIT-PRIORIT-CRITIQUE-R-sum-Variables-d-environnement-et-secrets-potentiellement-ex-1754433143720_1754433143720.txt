#2 - [SÉCURITÉ] - PRIORITÉ: CRITIQUE
Résumé: Variables d'environnement et secrets potentiellement exposés
Détails:

Fichier(s) concerné(s): /server/routes.ts, /shared/env.ts
Nature du problème: Absence de validation stricte des variables d'environnement
Impact: Risque d'exposition de secrets, injection de configuration malveillante
Contexte: Pas de fichier .env.example pour documenter les variables requises

Code problématique:
typescript// shared/env.ts - Manque de validation
export const env = {
  NODE_ENV: process.env.NODE_ENV || 'development',
  PORT: parseInt(process.env.PORT || '5000'),
  // Pas de validation pour JWT_SECRET, DATABASE_URL, etc.
PROMPT POUR L'ASSISTANT REPLIT:
"""
CONTEXTE: Le projet ClockPilot n'a pas de validation appropriée des variables d'environnement.
FICHIER À CRÉER: /shared/env-validation.ts
CODE À IMPLÉMENTER:
typescriptimport { z } from 'zod';

const envSchema = z.object({
  // Server
  NODE_ENV: z.enum(['development', 'production', 'test']),
  PORT: z.string().transform(Number).pipe(z.number().min(1).max(65535)),
  
  // Database
  DATABASE_URL: z.string().url().startsWith('postgresql://'),
  
  // Auth
  JWT_SECRET: z.string().min(32),
  JWT_REFRESH_SECRET: z.string().min(32),
  SESSION_SECRET: z.string().min(32),
  
  // Email
  SMTP_HOST: z.string().optional(),
  SMTP_PORT: z.string().transform(Number).optional(),
  SMTP_USER: z.string().email().optional(),
  SMTP_PASS: z.string().optional(),
  
  // Storage
  UPLOAD_DIR: z.string().default('./uploads'),
  MAX_FILE_SIZE: z.string().transform(Number).default('10485760'),
  
  // Frontend
  NEXT_PUBLIC_API_URL: z.string().url(),
  NEXT_PUBLIC_APP_URL: z.string().url(),
});

export type Env = z.infer<typeof envSchema>;

// Validate and export
export const env = envSchema.parse(process.env);

// Helper for client-side env vars
export const clientEnv = {
  API_URL: env.NEXT_PUBLIC_API_URL,
  APP_URL: env.NEXT_PUBLIC_APP_URL,
};
FICHIER À CRÉER: /.env.example
# Server Configuration
NODE_ENV=development
PORT=5000

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/clockpilot

# Authentication
JWT_SECRET=your-super-secret-jwt-key-min-32-chars
JWT_REFRESH_SECRET=your-refresh-secret-key-min-32-chars
SESSION_SECRET=your-session-secret-key-min-32-chars

# Email (optional)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# Storage
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760

# Frontend
NEXT_PUBLIC_API_URL=http://localhost:5000
NEXT_PUBLIC_APP_URL=http://localhost:3000
MODIFICATIONS dans tous les fichiers utilisant process.env :

Remplacer process.env.XXX par env.XXX
Importer depuis '/shared/env-validation'

VALIDATION:

L'app doit crasher au démarrage si des variables requises manquent
Les types TypeScript doivent être corrects pour toutes les variables
"""